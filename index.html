<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EzID v15.3 ä¼æ¥­ç©©å®šç‰ˆ</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.canvas-container{position:relative;width:340px;height:437px;margin:10px auto;background:#fff;border:4px solid #0f172a;border-radius:24px;overflow:hidden;touch-action:none;cursor:grab;box-shadow:0 25px 50px-12px rgba(0,0,0,.25)}
.canvas-container:active{cursor:grabbing}
.preview-overlay{position:fixed;inset:0;background:rgba(15,23,42,.98);z-index:1000;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}
.no-scrollbar::-webkit-scrollbar{display:none}
.tab-active{background:#fff!important;box-shadow:0 4px 12px rgba(0,0,0,.15)!important;transform:scale(1.02)}
.loading-spinner{width:16px;height:16px;border:2px solid #e5e7eb;border-top:2px solid #3b82f6;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
</style>
</head>
<body class="bg-slate-100 p-4 pb-24">
<div id="root"></div>
<script type="text/babel">
const{useState,useRef,useEffect,useCallback,useLayoutEffect}=React;
const SUITS={male:['male/m1.png','male/m2.png','male/m3.png','male/m4.png','male/m5.png'],female:['female/f1.png','female/f2.png','female/f3.png','female/f4.png','female/f5.png']};
const validateImageFile=file=>file&&file.size<8388608&&file.type.startsWith('image/');
function useCanvas(canvasRef,image,suitImg,photoT,suitT,config){const draw=useCallback(()=>{const canvas=canvasRef.current;if(!canvas)return;const ctx=canvas.getContext('2d'),{bright,guide}=config;ctx.fillStyle='#ffffff';ctx.fillRect(0,0,350,450);if(image?.complete){ctx.save();ctx.filter=`brightness(${bright}%)`;ctx.translate(175+photoT.x,225+photoT.y);ctx.rotate(photoT.r*Math.PI/180);ctx.scale(photoT.s*photoT.f,photoT.s);ctx.imageSmoothingQuality='high';ctx.drawImage(image,-image.width/2,-image.height/2);ctx.restore()}if(suitImg?.complete){ctx.save();ctx.translate(175+suitT.x,225+suitT.y);ctx.rotate(suitT.r*Math.PI/180);ctx.scale(suitT.s,suitT.s);ctx.imageSmoothingQuality='high';ctx.drawImage(suitImg,-suitImg.width/2,-suitImg.height/2);ctx.restore()}if(guide>0){ctx.save();ctx.globalAlpha=guide;ctx.strokeStyle=Math.abs(photoT.x)<5&&Math.abs(photoT.y+20)<5?'#10b981':'#ef4444';ctx.setLineDash([5,5]);ctx.lineWidth=2;ctx.lineCap='round';ctx.beginPath();ctx.ellipse(175,203,108,160,0,0,Math.PI*2);ctx.stroke();ctx.restore()}},[image?.complete,suitImg?.complete,photoT,suitT,config]);useLayoutEffect(()=>draw(),[draw])}
function App(){const[image,setImage]=useState(null),[suitImg,setSuitImg]=useState(null),[suitIndex,setSuitIndex]=useState(-1),[genderTab,setGenderTab]=useState('male'),[clothesLoaded,setClothesLoaded]=useState(0),[photoTransform,setPhotoTransform]=useState({x:0,y:-20,s:.45,r:0,f:1}),[suitTransform,setSuitTransform]=useState({x:0,y:80,s:1,r:0}),[config,setConfig]=useState({bright:100,guide:.7,name:'EzID'}),[slots,setSlots]=useState([]),[target,setTarget]=useState('PHOTO'),[preImg,setPreImg]=useState(null),[uiState,setUiState]=useState({isDragging:false,isLoadingSuit:false});const canvasRef=useRef(),dragRef=useRef({x:0,y:0}),revokeRef=useRef(new Set()),clothesCache=useRef({});useEffect(()=>()=>revokeRef.current.forEach(URL.revokeObjectURL),[]);const preloadClothes=useCallback(()=>{let count=0;SUITS.male.concat(SUITS.female).forEach((path,i)=>{if(clothesCache.current[i]){count++;setClothesLoaded(count);return}const img=new Image();img.onload=()=>{const c=document.createElement('canvas');c.width=img.width;c.height=img.height;c.getContext('2d').drawImage(img,0,0);clothesCache.current[i]=c.toDataURL('image/png',.9);count++;setClothesLoaded(Math.min(count,10))};img.onerror=()=>{clothesCache.current[i]=path;count++;setClothesLoaded(Math.min(count,10))};img.src=`clothes/${path}`})},[]);useEffect(()=>{preloadClothes()},[preloadClothes]);const handleDragStart=e=>{e.preventDefault();setUiState(s=>({...s,isDragging:true}));const rect=canvasRef.current?.getBoundingClientRect();if(!rect)return;const x=e.touches?.[0]?.clientX||e.clientX,y=e.touches?.[0]?.clientY||e.clientY;dragRef.current={x:x-rect.left,y:y-rect.top}};const handleDragMove=e=>{if(!uiState.isDragging)return;e.preventDefault();const rect=canvasRef.current?.getBoundingClientRect();if(!rect)return;const x=e.touches?.[0]?.clientX||e.clientX,y=e.touches?.[0]?.clientY||e.clientY,dx=(x-rect.left-dragRef.current.x)*.5,dy=(y-rect.top-dragRef.current.y)*.5;dragRef.current={x:x-rect.left,y:y-rect.top};target==='PHOTO'?setPhotoTransform(p=>({...p,x:Math.max(-180,Math.min(180,p.x+dx)),y:Math.max(-140,Math.min(240,p.y+dy))})):setSuitTransform(s=>({...s,x:Math.max(-180,Math.min(180,s.x+dx)),y:Math.max(-140,Math.min(240,s.y+dy))}))};const handleDragEnd=()=>{setUiState(s=>({...s,isDragging:false}))};const handleFileUpload=e=>{const file=e.target.files[0];if(!validateImageFile(file)){alert('è«‹ä¸Šå‚³8MBä»¥å…§åœ–ç‰‡');e.target.value='';return}const url=URL.createObjectURL(file);revokeRef.current.add(url);const img=new Image();img.onload=()=>{setImage(img);setTarget('PHOTO');setPhotoTransform({x:0,y:-20,s:.45,r:0,f:1})};img.onerror=()=>{alert('åœ–ç‰‡è¼‰å…¥å¤±æ•—');URL.revokeObjectURL(url);revokeRef.current.delete(url)};img.src=url};const loadSuit=i=>{if(suitIndex===i||uiState.isLoadingSuit)return;setUiState(s=>({...s,isLoadingSuit:true}));setSuitIndex(i);const src=clothesCache.current[i]||`clothes/${SUITS[genderTab][i%5]}`;const img=new Image();img.onload=()=>{setSuitImg(img);setTarget('SUIT');setUiState(s=>({...s,isLoadingSuit:false}))};img.onerror=()=>{setUiState(s=>({...s,isLoadingSuit:false}));alert('è¡£æœè¼‰å…¥å¤±æ•—')};img.src=src};const saveToSlot=()=>{if(!canvasRef.current)return;const c=document.createElement('canvas');c.width=350;c.height=450;c.getContext('2d').drawImage(canvasRef.current,0,0);setSlots(p=>[c.toDataURL('image/png',.92),...p.slice(0,9)])};const exportA4=async()=>{if(!slots.length){alert('è«‹å…ˆå­˜æ§½ä½');return}const c=document.createElement('canvas');c.width=2480;c.height=3508;const ctx=c.getContext('2d');ctx.fillStyle='#ffffff';ctx.fillRect(0,0,2480,3508);const imgs=await Promise.all(slots.slice(0,20).map(src=>new Promise(r=>{const i=new Image();i.crossOrigin='anonymous';i.onload=()=>r(i);i.onerror=()=>r(null);i.src=src})));for(let i=0;i<imgs.length;i++){const img=imgs[i];if(img){const x=205+(i%4)*520,y=300+Math.floor(i/4)*600;ctx.drawImage(img,x,y,413,531);ctx.strokeStyle='#e5e7eb';ctx.lineWidth=3;ctx.strokeRect(x,y,413,531)}}setPreImg(c.toDataURL('image/png',.95))};const getFullFileName=()=>{const d=new Date();return`${config.name}_${d.toISOString().slice(2,16).replace(/[:-]/g,'')}.png`};useCanvas(canvasRef,image,suitImg,photoTransform,suitTransform,config);return React.createElement('div',{className:'max-w-md mx-auto p-4 space-y-4 pb-24'},React.createElement('div',{className:'fixed top-4 left-1/2 -translate-x-1/2 bg-white/95 backdrop-blur-sm px-4 py-2 rounded-2xl shadow-xl z-50 border'},clothesLoaded===10?React.createElement('span',{className:'text-emerald-600 font-bold text-sm flex items-center gap-2'},'âœ… æº–å‚™å®Œæˆï¼'):React.createElement('span',{className:'text-blue-600 font-bold text-sm flex items-center gap-2'},'â³ è¼‰å…¥ä¸­ ',clothesLoaded,'/10',React.createElement('div',{className:'loading-spinner'}))),React.createElement('div',{className:'bg-white/90 p-5 rounded-3xl shadow-xl border'},React.createElement('div',{className:'flex justify-between items-center mb-3'},React.createElement('h1',{className:'text-xl font-black text-slate-800'},'EzID v15.3'),React.createElement('div',{className:'flex gap-1'},React.createElement('input',{value:config.name,onChange:e=>setConfig(c=>({...c,name:e.target.value.slice(0,20)})),className:'w-20 px-2 py-1 bg-slate-100 rounded text-sm font-bold border',maxLength:20}),React.createElement('button',{onClick:()=>setPhotoTransform(p=>({...p,f:p.f*-1})),className:'px-2 py-1 bg-slate-700 text-white rounded text-xs font-bold hover:bg-slate-800 ml-1'},'ğŸ”„'),React.createElement('button',{onClick:()=>{setPhotoTransform({x:0,y:-20,s:.45,r:0,f:1});setSuitTransform({x:0,y:80,s:1,r:0})},className:'px-2 py-1 bg-emerald-500 text-white rounded text-xs font-bold hover:bg-emerald-600 ml-1'},'â†º')))),React.createElement('div',{className:`canvas-container ${uiState.isDragging?'grabbing':''}`,onPointerDown:handleDragStart,onPointerMove:handleDragMove,onPointerUp:handleDragEnd,onPointerLeave:handleDragEnd,onTouchStart:handleDragStart,onTouchMove:handleDragMove,onTouchEnd:handleDragEnd},React.createElement('canvas',{ref:canvasRef,width:350,height:450,className:'w-full h-full'})),React.createElement('div',{className:'bg-white p-4 rounded-3xl shadow-xl border'},React.createElement('div',{className:'flex mb-4'},React.createElement('button',{onClick:()=>setGenderTab('male'),className:`flex-1 py-3 px-4 font-bold rounded-2xl mr-2 ${genderTab==='male'?'tab-active text-blue-600 bg-gradient-to-r from-blue-400 to-blue-500 text-white':'bg-slate-200 hover:bg-slate-300 text-slate-700'}`},'ğŸ‘¨ ç”·è£'),React.createElement('button',{onClick:()=>setGenderTab('female'),className:`flex-1 py-3 px-4 font-bold rounded-2xl ${genderTab==='female'?'tab-active text-pink-600 bg-gradient-to-r from-pink-400 to-pink-500 text-white':'bg-slate-200 hover:bg-slate-300 text-slate-700'}`},'ğŸ‘© å¥³è£')),React.createElement('div',{className:'flex gap-2 overflow-x-auto no-scrollbar pb-2 -mb-2'},React.createElement('button',{onClick:()=>{setSuitImg(null);setSuitIndex(-1);setTarget('PHOTO')},className:'w-16 h-16 rounded-2xl border-2 border-dashed border-red-300 bg-red-50 flex items-center justify-center hover:bg-red-100 active:scale-95'},'ğŸš«'),SUITS[genderTab].map((suit,i)=>React.createElement('button',{key:i,onClick:()=>loadSuit(i),disabled:uiState.isLoadingSuit,className:`w-16 h-16 rounded-2xl border-2 overflow-hidden ${suitIndex===i?'border-blue-500 ring-2 ring-blue-200 scale-105 shadow-lg':'border-slate-200 hover:border-blue-400 hover:scale-105'} ${uiState.isLoadingSuit?'opacity-50':''}`},React.createElement('img',{src:clothesCache.current[i]||`clothes/${suit}`,className:'w-full h-full object-cover'})))))),React.createElement('div',{className:'bg-white p-6 rounded-3xl shadow-xl border space-y-4'},React.createElement('div',{className:'flex bg-slate-200 p-1 rounded-2xl'},React.createElement('button',{onClick:()=>setTarget('PHOTO'),className:`flex-1 py-3 text-sm font-bold rounded-xl ${target==='PHOTO'?'bg-white shadow-md text-blue-600':'text-slate-500 hover:bg-white/50'}`},'ğŸ‘¤ äººåƒ'),React.createElement('button',{onClick:()=>setTarget('SUIT'),className:`flex-1 py-3 text-sm font-bold rounded-xl ${target==='SUIT'?'bg-white shadow-md text-blue-600':'text-slate-500 hover:bg-white/50'}`},'ğŸ‘• è¡£æœ')),React.createElement('div',{className:'space-y-3'},[React.createElement('div',{className:'flex items-center gap-3',key:'size'},React.createElement('span',{className:'text-xs font-bold text-slate-500 w-12'},'SIZE'),React.createElement('input',{type:'range',min:.1,max:2.5,step:.01,value:target==='PHOTO'?photoTransform.s:suitTransform.s,onChange:e=>target==='PHOTO'?setPhotoTransform(p=>({...p,s:+e.target.value})):setSuitTransform(s=>({...s,s:+e.target.value})),className:'flex-1 h-2 bg-slate-200 rounded-lg accent-blue-500'}),React.createElement('span',{className:'text-sm font-mono w-12 text-right font-bold'},(target==='PHOTO'?photoTransform.s:suitTransform.s).toFixed(2))),React.createElement('div',{className:'flex items-center gap-3',key:'rotate'},React.createElement('span',{className:'text-xs font-bold text-slate-500 w-12'},'ROTATE'),React.createElement('input',{type:'range',min:-60,max:60,step:1,value:target==='PHOTO'?photoTransform.r:suitTransform.r,onChange:e=>target==='PHOTO'?setPhotoTransform(p=>({...p,r:+e.target.value})):setSuitTransform(s=>({...s,r:+e.target.value})),className:'flex-1 h-2 bg-slate-200 rounded-lg accent-emerald-500'}),React.createElement('span',{className:'text-sm font-mono w-12 text-right font-bold'},target==='PHOTO'?photoTransform.r:suitTransform.r,'Â°')),React.createElement('div',{className:'flex items-center gap-3',key:'bright'},React.createElement('span',{className:'text-xs font-bold text-slate-500 w-12'},'BRIGHT'),React.createElement('input',{type:'range',min:50,max:150,step:1,value:config.bright,onChange:e=>setConfig(c=>({...c,bright:+e.target.value})),className:'flex-1 h-2 bg-slate-200 rounded-lg accent-amber-500'}),React.createElement('span',{className:'text-sm font-mono w-12 text-right font-bold'},config.bright,'%')),React.createElement('div',{className:'flex items-center gap-3',key:'guide'},React.createElement('span',{className:'text-xs font-bold text-slate-500 w-12'},'GUIDE'),React.createElement('input',{type:'range',min:0,max:1,step:.1,value:config.guide,onChange:e=>setConfig(c=>({...c,guide:+e.target.value})),className:'flex-1 h-2 bg-slate-200 rounded-lg accent-slate-400'}),React.createElement('span',{className:'text-sm font-mono w-12 text-right font-bold'},Math.round(config.guide*100),'%'))])),React.createElement('div',{className:'grid grid-cols-2 gap-4'},React.createElement('label',{className:'bg-gradient-to-r from-slate-800 to-slate-900 text-white py-5 rounded-3xl text-center font-black shadow-xl hover:shadow-2xl cursor-pointer block'},'ğŸ“¸ ä¸Šå‚³ç…§ç‰‡',React.createElement('input',{type:'file',accept:'image/*',hidden:true,onChange:handleFileUpload})),React.createElement('button',{onClick:saveToSlot,className:'bg-gradient-to-r from-blue-600 to-blue-700 text-white py-5 rounded-3xl font-black shadow-xl hover:shadow-2xl'},'ğŸ“¥ å­˜æ§½ä½ (',slots.length,'/10)')),React.createElement('div',{className:'bg-slate-100 p-4 rounded-3xl flex gap-3 overflow-x-auto no-scrollbar min-h-[140px]'},slots.map((slot,i)=>React.createElement('div',{key:i,className:'relative w-24 h-32 bg-white rounded-2xl shadow-md flex-shrink-0 border hover:shadow-xl overflow-hidden'},React.createElement('img',{src:slot,className:'w-full h-full object-cover'}),React.createElement('button',{className:'absolute top-1 right-1 bg-red-500 text-white w-6 h-6 rounded-full text-xs font-bold hover:bg-red-600',onClick:()=>setSlots(p=>p.filter((_,idx)=>idx!==i))},'Ã—')))),React.createElement('div',{className:'bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-6 rounded-3xl shadow-xl hover:shadow-2xl cursor-pointer'},React.createElement('button',{onClick:exportA4,className:'w-full font-black text-lg'},'ğŸ–¨ï¸ A4å°ˆæ¥­æ’ç‰ˆ')),preImg&&React.createElement('div',{className:'preview-overlay',onClick:e=>e.target===e.currentTarget&&setPreImg(null)},React.createElement('div',{className:'bg-white p-6 rounded-3xl max-w-[95vw] max-h-[80vh] overflow-auto shadow-2xl',onClick:e=>e.stopPropagation()},React.createElement('img',{src:preImg,className:'w-full h-auto rounded-2xl mb-6'}),React.createElement('div',{className:'flex gap-4'},React.createElement('button',{onClick:()=>setPreImg(null),className:'flex-1 py-3 bg-slate-700 hover:bg-slate-800 text-white rounded-2xl font-bold'},'è¿”å›'),React.createElement('a',{href:preImg,download:getFullFileName(),className:'flex-1 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl font-bold text-center'},'ğŸ’¾ ä¸‹è¼‰'))))))}
ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
