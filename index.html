<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EzID v20.23 çµ‚æ¥µå§“åå·¥ç‰Œç‰ˆ - çœŸå¯¦å…¨ç¢¼ä¸çœç•¥</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face { 
            font-family: 'NotoSansTC'; 
            src: local('Noto Sans TC'), local('Microsoft JhengHei'), sans-serif; 
            font-weight: 700; 
        }
        body { 
            font-family: 'NotoSansTC', sans-serif; 
            background: #f8fafc; 
            touch-action: pan-y; 
            margin: 0;
            padding: 0;
        }
        .canvas-main { 
            border-radius: 40px; 
            background: white; 
            box-shadow: 0 30px 60px -12px rgba(0,0,0,0.3); 
            touch-action: none; 
            border: 4px solid #fff; 
        }
        .no-scrollbar::-webkit-scrollbar { 
            display: none; 
        }
        .active-target { 
            background: #2563eb !important; 
            color: white !important; 
            box-shadow: 0 10px 15px -3px rgba(37,99,235,0.3); 
        }
        .slot-thumb { 
            width: 60px; 
            height: 80px; 
            object-fit: cover; 
            border-radius: 8px; 
            border: 2px solid #e2e8f0; 
        }
        .name-input { 
            width: 100%; 
            padding: 12px; 
            font-size: 16px; 
            border: 2px solid #e2e8f0; 
            border-radius: 12px; 
            outline: none; 
            transition: all 0.2s; 
            background: white;
            font-weight: 500;
        }
        .name-input:focus {
            border-color: #2563eb; 
            box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
        }
        .name-list { 
            max-height: 240px; 
            overflow-y: auto; 
        }
    </style>
</head>
<body class="pb-10">
    <div id="root"></div>

<script type="text/babel">
const { useState, useRef, useEffect, useTransition, useCallback } = React;

// ğŸ›¡ï¸ 12ç¨®è¦æ ¼å®Œå…¨ç¡¬ç·¨ç¢¼ï¼Œçµ•ä¸ç°¡åŒ–
const SPECS = {
    'A4-20':  { w: 2480, h: 3508, photos: 20, grid: [5, 4], size: [413, 531], name: 'A4 2å‹(20å¼µ)' },
    'A4-42':  { w: 2480, h: 3508, photos: 42, grid: [7, 6], size: [295, 413], name: 'A4 1å‹(42å¼µ)' },
    'A4-MIX': { w: 2480, h: 3508, type: 'MIX', name: 'A4 ç¶œåˆ(12+18)' },
    'A4-BIG': { w: 2480, h: 3508, photos: 12, grid: [4, 3], size: [531, 708], name: 'A4 å¤§é ­(12å¼µ)' },
    'A4-ID':  { w: 2480, h: 3508, photos: 16, grid: [4, 4], size: [450, 600], name: 'A4 è­‰ä»¶(16å¼µ)' },
    'A4-B':   { w: 2480, h: 3508, photos: 30, grid: [6, 5], size: [354, 472], name: 'A4 æ··åˆBç‰ˆ' },
    '4x6-8':  { w: 1800, h: 1200, photos: 8,  grid: [2, 4], size: [413, 531], name: '4x6 2å‹(8å¼µ)' },
    '4x6-10': { w: 1800, h: 1200, photos: 10, grid: [2, 5], size: [295, 413], name: '4x6 1å‹(10å¼µ)' },
    '4x6-BIG':{ w: 1800, h: 1200, photos: 6,  grid: [2, 3], size: [531, 708], name: '4x6 å¤§é ­ç…§(6å¼µ)' },
    '4x6-12': { w: 1800, h: 1200, photos: 12, grid: [3, 4], size: [295, 413], name: '4x6 1å‹(12å¼µ)' },
    '4x6-MIX':{ w: 1800, h: 1200, type: 'MIX46', name: '4x6 æ··åˆ(4+4)' },
    'NAME':   { w: 2480, h: 3508, photos: 24, grid: [6, 4], size: [295, 413], special: 'NAME', name: 'ğŸ‘¨â€ğŸ’¼ å§“åå·¥ç‰Œç‰ˆ(24äºº)' }
};

const CLOTHES = {
    male: ['m1.png', 'm2.png', 'm3.png', 'm4.png', 'm5.png'],
    female: ['f1.png', 'f2.png', 'f3.png', 'f4.png', 'f5.png']
};

function App() {
    const [isPending, startTransition] = useTransition();
    const [image, setImage] = useState(null);
    const [suitImg, setSuitImg] = useState(null);
    const [gender, setGender] = useState('male');
    const [target, setTarget] = useState('PHOTO');
    const [pT, setPT] = useState({ x: 0, y: -20, s: 0.45, r: 0 });
    const [sT, setST] = useState({ x: 0, y: 80, s: 1.0, r: 0 });
    const [slots, setSlots] = useState([]);
    const [names, setNames] = useState(Array(24).fill(''));
    const [preview, setPreview] = useState(null);
    const canvasRef = useRef(null);
    const drag = useRef({ active: false, x: 0, y: 0 });

    // ğŸŸ¢ ç²¾ç¢ºæ©¢åœ“äººç‰©åœˆ
    const drawEllipse = (ctx) => {
        ctx.save();
        ctx.beginPath();
        ctx.ellipse(175, 210, 110, 150, 0, 0, Math.PI * 2);
        ctx.strokeStyle = "rgba(16, 185, 129, 0.7)";
        ctx.lineWidth = 3;
        ctx.setLineDash([10, 5]);
        ctx.stroke();
        ctx.restore();
    };

    // ğŸ¨ å®Œæ•´ç¹ªåœ–å‡½æ•¸ - æ”¯æ´å§“åé¡¯ç¤º
    const drawSingle = (ctx, img, sImg, photoT, suitT, x, y, pw, ph, isExport = false, nameIndex = -1, customName = '') => {
        const scaleRatio = isExport ? pw / 350 : 1;
        
        // è£åˆ‡å€åŸŸ
        ctx.save();
        ctx.beginPath();
        ctx.rect(x, y, pw, ph);
        ctx.clip();
        
        // 1. ç•«äººåƒ (åº•å±¤)
        if (img) {
            ctx.save();
            ctx.translate(x + pw/2 + photoT.x * scaleRatio, y + ph/2 + photoT.y * scaleRatio);
            ctx.rotate(photoT.r * Math.PI / 180);
            ctx.scale(photoT.s * scaleRatio, photoT.s * scaleRatio);
            ctx.imageSmoothingQuality = 'high';
            ctx.drawImage(img, -img.width/2, -img.height/2);
            ctx.restore();
        }
        
        // 2. ç•«è¥¿è£ (é ‚å±¤)
        if (sImg) {
            ctx.save();
            ctx.translate(x + pw/2 + suitT.x * scaleRatio, y + ph/2 + suitT.y * scaleRatio);
            ctx.rotate(suitT.r * Math.PI / 180);
            ctx.scale(suitT.s * scaleRatio, suitT.s * scaleRatio);
            ctx.imageSmoothingQuality = 'high';
            ctx.drawImage(sImg, -sImg.width/2, -sImg.height/2);
            ctx.restore();
        }
        ctx.restore();

        // ğŸ”¥ å§“åå·¥ç‰Œå°ˆç”¨ - é¡¯ç¤ºè‡ªè¨‚å§“å
        if (isExport && customName && nameIndex >= 0) {
            // å§“åèƒŒæ™¯
            ctx.fillStyle = "#f8fafc";
            ctx.fillRect(x, y + ph - 70, pw, 70);
            
            // å§“åæ–‡å­—
            ctx.fillStyle = "#1e293b";
            ctx.font = "bold 40px 'NotoSansTC', sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(customName.slice(0, 8) || `å“¡å·¥${String(nameIndex+1).padStart(2, '0')}`, x + pw/2, y + ph - 42);
            
            // å“¡å·¥ç·¨è™Ÿ
            ctx.font = "bold 26px sans-serif";
            ctx.fillStyle = "#2563eb";
            ctx.fillText(`#${String(nameIndex+1).padStart(2, '0')}`, x + pw/2, y + ph - 12);
        }
        
        if (!isExport) {
            drawEllipse(ctx);
        }
    };

    // ğŸ–¼ï¸ å³æ™‚é è¦½æ›´æ–°
    useEffect(() => {
        const ctx = canvasRef.current?.getContext('2d');
        if (!ctx) return;
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, 350, 450);
        drawSingle(ctx, image, suitImg, pT, sT, 0, 0, 350, 450);
    }, [image, suitImg, pT, sT]);

    // ğŸ–±ï¸ æ‹–æ‹½è™•ç†
    const handlePointerMove = (e) => {
        if (!drag.current.active) return;
        const dx = e.clientX - drag.current.x;
        const dy = e.clientY - drag.current.y;
        if (target === 'PHOTO') {
            setPT(prev => ({ ...prev, x: prev.x + dx, y: prev.y + dy }));
        } else {
            setST(prev => ({ ...prev, x: prev.x + dx, y: prev.y + dy }));
        }
        drag.current.x = e.clientX;
        drag.current.y = e.clientY;
    };

    // ğŸ’¾ å­˜å…¥æ§½ä½ (ç…§ç‰‡ + è¨­å®š + å§“å)
    const saveSlot = () => {
        if (!image) {
            alert("è«‹å…ˆä¸Šå‚³ç…§ç‰‡ï¼");
            return;
        }
        const canvas = document.createElement('canvas');
        canvas.width = 70;
        canvas.height = 90;
        const ctx = canvas.getContext('2d');
        drawSingle(ctx, image, suitImg, pT, sT, 0, 0, 70, 90, true);
        
        const newSlots = [...slots, {
            image: image,
            suitImg: suitImg,
            pT: { ...pT },
            sT: { ...sT },
            thumb: canvas.toDataURL('image/png', 1.0),
            name: names[slots.length] || ''
        }];
        setSlots(newSlots);
        
        // è‡ªå‹•å¡«å…¥é è¨­å§“å
        const newNames = [...names];
        if (!newNames[slots.length]) {
            newNames[slots.length] = `å“¡å·¥${String(slots.length + 1).padStart(2, '0')}`;
        }
        setNames(newNames);
    };

    // âœï¸ æ›´æ–°å§“å
    const updateName = useCallback((index, value) => {
        const newNames = [...names];
        newNames[index] = value.slice(0, 8);
        setNames(newNames);
    }, [names]);

    // ğŸ–¨ï¸ é«˜æ¸…å°å‡ºå¼•æ“
    const handleExport = (key) => {
        const spec = SPECS[key];
        
        // å§“åå·¥ç‰Œç‰ˆæª¢æŸ¥
        if (spec.special === 'NAME' && slots.length === 0) {
            alert('è«‹å…ˆä½¿ç”¨ã€Œå­˜å…¥æ§½ä½ã€åŠŸèƒ½å„²å­˜è‡³å°‘1å¼µç…§ç‰‡ï¼');
            return;
        }
        
        startTransition(async () => {
            const canvas = document.createElement('canvas');
            canvas.width = spec.w;
            canvas.height = spec.h;
            const ctx = canvas.getContext('2d', { alpha: false });
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, spec.w, spec.h);

            const renderTask = async (numPhotos, gridRowsCols, photoSize, yOffset = 0) => {
                const [rows, cols] = gridRowsCols;
                const [pw, ph] = photoSize;
                const marginX = (spec.w - cols * pw) / (cols + 1);
                const marginY = (spec.h / (spec.type ? 2.1 : 1) - rows * ph) / (rows + 1);
                
                for (let i = 0; i < numPhotos; i++) {
                    const row = Math.floor(i / cols);
                    const col = i % cols;
                    const x = marginX + col * (pw + marginX);
                    const y = yOffset + marginY + row * (ph + marginY);
                    
                    // å–å¾—å°æ‡‰æ§½ä½è³‡æ–™æˆ–ä½¿ç”¨ç•¶å‰è¨­å®š
                    const slotData = slots[i] || { image, suitImg, pT, sT };
                    const nameForThisPhoto = spec.special === 'NAME' ? names[i] || '' : '';
                    
                    // ç¹ªè£½å–®å¼µç…§ç‰‡
                    drawSingle(ctx, slotData.image, slotData.suitImg, slotData.pT, slotData.sT, x, y, pw, ph, true, i, nameForThisPhoto);
                    
                    // é‚Šæ¡†
                    ctx.strokeStyle = "#e5e7eb";
                    ctx.lineWidth = 3;
                    ctx.strokeRect(x, y, pw, ph);
                    
                    // é€²åº¦ç¯€æµï¼Œé¿å…é˜»å¡
                    if (i % 5 === 0) {
                        await new Promise(resolve => requestAnimationFrame(resolve));
                    }
                }
            };

            try {
                // æ··åˆç‰ˆç‰¹æ®Šè™•ç†
                if (spec.type === 'MIX') {
                    await renderTask(12, [3, 4], [413, 531], 0);
                    await renderTask(18, [3, 6], [295, 413], spec.h * 0.48);
                } else if (spec.type === 'MIX46') {
                    await renderTask(4, [1, 4], [413, 531], 0);
                    await renderTask(4, [1, 4], [295, 413], spec.h * 0.5);
                } else {
                    const totalPhotos = spec.photos || (spec.grid[0] * spec.grid[1]);
                    await renderTask(totalPhotos, spec.grid, spec.size, 0);
                }
                
                // ç”Ÿæˆæœ€çµ‚åœ–ç‰‡
                setPreview(canvas.toDataURL('image/jpeg', 0.95));
            } catch (error) {
                console.error('å°å‡ºå¤±æ•—:', error);
                alert('å°å‡ºéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡è©¦ï¼');
            }
        });
    };

    return (
        <div className="max-w-md mx-auto p-6 space-y-6 pt-4 pb-12">
            {/* ğŸš€ æ¨™é¡Œå€ */}
            <div className="text-center space-y-2">
                <h1 className="text-4xl font-black text-slate-800 tracking-tighter">EzID</h1>
                <div className="text-sm font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent tracking-wide">
                    v20.23 çµ‚æ¥µå§“åå·¥ç‰Œç‰ˆ âœ¨
                </div>
            </div>

            {/* ğŸ–¼ï¸ ä¸»è¦ç•«å¸ƒ */}
            <div className="flex justify-center">
                <canvas 
                    ref={canvasRef} 
                    width="350" 
                    height="450" 
                    className="canvas-main"
                    onPointerDown={e => {
                        e.target.setPointerCapture(e.pointerId);
                        drag.current = { active: true, x: e.clientX, y: e.clientY };
                    }}
                    onPointerMove={handlePointerMove}
                    onPointerUp={() => drag.current.active = false}
                    onPointerLeave={() => drag.current.active = false}
                />
            </div>

            {/* âš¡ åˆ‡æ›ç›®æ¨™ */}
            <div className="flex bg-slate-200 p-2 rounded-2xl border border-slate-300">
                <button 
                    onClick={() => setTarget('PHOTO')} 
                    className={`flex-1 py-4 px-3 rounded-xl font-black text-sm transition-all ${
                        target === 'PHOTO' 
                            ? 'active-target' 
                            : 'text-slate-500 hover:bg-slate-300'
                    }`}
                >
                    ğŸ‘¤ èª¿äººåƒ
                </button>
                <button 
                    onClick={() => setTarget('SUIT')} 
                    className={`flex-1 py-4 px-3 rounded-xl font-black text-sm transition-all ${
                        target === 'SUIT' 
                            ? 'active-target' 
                            : 'text-slate-500 hover:bg-slate-300'
                    }`}
                >
                    ğŸ‘” èª¿è¥¿è£
                </button>
            </div>

            {/* ğŸ“ ç¸®æ”¾æ»‘æ¡¿ */}
            <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 space-y-4">
                <div className="flex justify-between items-center text-xs font-black text-slate-500 uppercase tracking-widest">
                    <span>{target === 'PHOTO' ? 'äººåƒ' : 'è¥¿è£'} ç¸®æ”¾</span>
                    <span className="text-blue-600 font-mono text-sm">
                        {(target === 'PHOTO' ? pT.s : sT.s).toFixed(2)}x
                    </span>
                </div>
                <input 
                    type="range" 
                    min="0.1" 
                    max="1.5" 
                    step="0.01" 
                    value={target === 'PHOTO' ? pT.s : sT.s}
                    onChange={e => {
                        const value = parseFloat(e.target.value);
                        if (target === 'PHOTO') {
                            setPT(prev => ({ ...prev, s: value }));
                        } else {
                            setST(prev => ({ ...prev, s: value }));
                        }
                    }}
                    className="w-full h-2 bg-slate-100 rounded-xl accent-blue-600 cursor-pointer"
                />
            </div>

            {/* ğŸ”¥ å§“åè¼¸å…¥æ ¸å¿ƒå€ */}
            <div className="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-6 rounded-3xl border-2 border-blue-100 shadow-xl">
                <h3 className="font-black text-xl text-blue-800 text-center mb-6 tracking-tight">
                    ğŸ‘¨â€ğŸ’¼ å§“åå·¥ç‰Œè¨­å®š (24äººä»½)
                </h3>
                
                <div className="flex gap-3 mb-6">
                    <button 
                        onClick={saveSlot} 
                        disabled={!image}
                        className="flex-1 h-16 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-3xl font-black text-lg shadow-xl hover:shadow-2xl active:scale-[0.98] transition-all disabled:bg-slate-300 disabled:cursor-not-allowed disabled:shadow-none"
                    >
                        ğŸ’¾ å­˜å…¥æ§½ä½ + å§“å
                    </button>
                    <button 
                        onClick={() => {
                            setSlots([]);
                            setNames(Array(24).fill(''));
                        }}
                        className="w-20 h-16 bg-gradient-to-r from-red-400 to-red-500 text-white rounded-3xl font-black shadow-lg hover:shadow-xl active:scale-[0.98] transition-all"
                    >
                        æ¸…ç©º
                    </button>
                </div>

                <div className="name-list space-y-3">
                    {Array(24).fill(0).map((_, index) => (
                        <div key={index} className="flex items-center gap-3 p-4 bg-white/80 backdrop-blur-sm rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-all">
                            <div className="w-10 h-10 bg-gradient-to-r from-slate-400 to-slate-500 rounded-2xl flex items-center justify-center text-white font-bold text-sm flex-shrink-0">
                                {index + 1}
                            </div>
                            <input 
                                value={names[index] || ''}
                                onChange={(e) => updateName(index, e.target.value)}
                                placeholder={`å“¡å·¥${String(index + 1).padStart(2, '0')}`}
                                className="name-input flex-1"
                                maxLength={8}
                            />
                            {slots[index] && (
                                <div className="w-10 h-10 bg-gradient-to-r from-green-400 to-green-500 rounded-2xl flex items-center justify-center text-white font-bold text-sm flex-shrink-0">
                                    âœ“
                                </div>
                            )}
                        </div>
                    ))}
                </div>

                {slots.length > 0 && (
                    <div className="mt-4 pt-4 border-t border-blue-100">
                        <p className="text-xs text-slate-500 font-medium text-center">
                            å·²å„²å­˜ <strong className="text-blue-600">{slots.length}</strong> / 24 å¼µç…§ç‰‡
                        </p>
                    </div>
                )}
            </div>

            {/* ğŸ‘• è¥¿è£é¸æ“‡ */}
            {slots.length === 0 && (
                <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 space-y-4">
                    <div className="flex gap-3">
                        <button 
                            onClick={() => setGender('male')}
                            className={`flex-1 py-3 rounded-2xl font-black text-sm transition-all ${
                                gender === 'male' 
                                    ? 'bg-slate-800 text-white shadow-lg' 
                                    : 'bg-slate-100 text-slate-500 hover:bg-slate-200'
                            }`}
                        >
                            ç”·è£
                        </button>
                        <button 
                            onClick={() => setGender('female')}
                            className={`flex-1 py-3 rounded-2xl font-black text-sm transition-all ${
                                gender === 'female' 
                                    ? 'bg-slate-800 text-white shadow-lg' 
                                    : 'bg-slate-100 text-slate-500 hover:bg-slate-200'
                            }`}
                        >
                            å¥³è£
                        </button>
                    </div>
                    <div className="flex gap-3 overflow-x-auto no-scrollbar p-1">
                        <button 
                            onClick={() => setSuitImg(null)}
                            className="flex-shrink-0 w-16 h-16 bg-red-50 text-red-500 rounded-2xl font-bold border-2 border-dashed border-red-200 flex items-center justify-center text-lg"
                        >
                            ğŸš«
                        </button>
                        {CLOTHES[gender].map((filename, idx) => (
                            <img 
                                key={filename}
                                src={`clothes/${gender}/${filename}`}
                                onClick={() => {
                                    const img = new Image();
                                    img.onload = () => {
                                        setSuitImg(img);
                                        setTarget('SUIT');
                                    };
                                    img.src = `clothes/${gender}/${filename}`;
                                }}
                                className="flex-shrink-0 w-16 h-16 rounded-2xl cursor-pointer object-cover bg-slate-50 border-2 border-slate-200 hover:border-blue-400 hover:shadow-md transition-all"
                            />
                        ))}
                    </div>
                </div>
            )}

            {/* ğŸ“ æ§½ä½é è¦½ */}
            {slots.length > 0 && (
                <div className="bg-white p-5 rounded-3xl shadow-sm border border-slate-200">
                    <h4 className="font-black text-slate-800 text-sm mb-3 uppercase tracking-wider text-center">ğŸ“¸ å·²å„²å­˜ç…§ç‰‡é è¦½</h4>
                    <div className="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                        {slots.map((slot, idx) => (
                            <div key={idx} className="relative flex-shrink-0">
                                <img src={slot.thumb} className="slot-thumb shadow-sm" />
                                <div className="absolute -top-2 -right-2 bg-blue-600 text-white text-xs px-2 py-1 rounded-full font-bold min-w-[28px] flex items-center justify-center shadow-lg">
                                    {idx + 1}
                                </div>
                                {slot.name && (
                                    <div className="absolute bottom-0 left-0 right-0 bg-black/70 text-white text-[10px] px-1 text-center rounded-b-lg truncate">
                                        {slot.name}
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* ğŸ”„ æ“ä½œæŒ‰éˆ• */}
            <div className="grid grid-cols-2 gap-4">
                <label className="flex items-center justify-center bg-gradient-to-r from-slate-800 to-slate-900 text-white h-20 rounded-3xl font-black text-lg cursor-pointer shadow-2xl hover:shadow-3xl active:scale-95 transition-all">
                    ğŸ“¸ ä¸Šå‚³ç…§ç‰‡
                    <input 
                        type="file" 
                        hidden 
                        accept="image/*"
                        onChange={e => {
                            const file = e.target.files[0];
                            if (file) {
                                const url = URL.createObjectURL(file);
                                const img = new Image();
                                img.onload = () => {
                                    setImage(img);
                                    URL.revokeObjectURL(url);
                                    setPT({ x: 0, y: -20, s: 0.45, r: 0 });
                                    setST({ x: 0, y: 80, s: 1.0, r: 0 });
                                };
                                img.src = url;
                            }
                        }}
                    />
                </label>
                <button 
                    onClick={() => {
                        setImage(null);
                        setSuitImg(null);
                        setPT({ x: 0, y: -20, s: 0.45, r: 0 });
                        setST({ x: 0, y: 80, s: 1.0, r: 0 });
                        setSlots([]);
                        setNames(Array(24).fill(''));
                        setPreview(null);
                    }}
                    className="bg-gradient-to-r from-slate-50 to-slate-100 border-2 border-slate-300 text-slate-600 h-20 rounded-3xl font-black text-lg hover:shadow-lg active:scale-95 transition-all"
                >
                    ğŸ”„ é‡ç½®å…¨éƒ¨
                </button>
            </div>

            {/* ğŸ–¨ï¸ è¦æ ¼é¸æ“‡ */}
            <div className="bg-white p-8 rounded-4xl shadow-xl border border-slate-100">
                <h3 className="text-center font-black text-xl text-slate-800 mb-6 tracking-tight uppercase">
                    ğŸ–¨ï¸ 12ç¨®å°ˆæ¥­è¦æ ¼è¼¸å‡º
                </h3>
                <div className="grid grid-cols-2 gap-3 max-h-80 overflow-y-auto no-scrollbar p-2">
                    {Object.keys(SPECS).map(key => {
                        const spec = SPECS[key];
                        return (
                            <button 
                                key={key}
                                onClick={() => handleExport(key)}
                                disabled={!image || isPending}
                                className={`h-20 rounded-3xl font-black text-sm border-2 transition-all shadow-lg active:scale-[0.97] ${
                                    !image || isPending
                                        ? 'bg-slate-50 text-slate-400 border-slate-200 cursor-not-allowed'
                                        : key === 'NAME'
                                        ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white border-purple-300 shadow-purple-300 hover:shadow-purple-400 hover:from-purple-600'
                                        : 'bg-gradient-to-r from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 text-slate-800 border-blue-200 hover:border-blue-300 hover:shadow-xl'
                                }`}
                            >
                                {spec.name}
                                {key === 'NAME' && slots.length > 0 && (
                                    <div className="text-[10px] mt-1 opacity-90">å·²å­˜ {slots.length} äºº</div>
                                )}
                            </button>
                        );
                    })}
                </div>
            </div>

            {/* ğŸ“± é è¦½å½ˆçª— */}
            {preview && (
                <div className="fixed inset-0 bg-slate-900/95 backdrop-blur-xl z-[9999] flex flex-col p-6 items-center justify-center">
                    <img 
                        src={preview} 
                        className="max-w-full max-h-[75vh] border-8 border-white/50 shadow-2xl rounded-2xl mb-8 w-auto h-auto"
                        alt="é è¦½åœ–ç‰‡"
                    />
                    <div className="flex gap-4 w-full max-w-sm">
                        <button 
                            onClick={() => setPreview(null)}
                            className="flex-1 h-20 bg-slate-700/90 backdrop-blur-sm text-white rounded-4xl font-black text-lg shadow-2xl hover:shadow-3xl active:scale-[0.97] transition-all border border-slate-600/50"
                        >
                            â† è¿”å›ç·¨è¼¯
                        </button>
                        <a 
                            href={preview} 
                            download={`EzID_å§“åå·¥ç‰Œ_${new Date().toISOString().slice(0, 10).replace(/-/g, '')}_${slots.length || 1}äºº.jpg`}
                            className="flex-1 h-20 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-4xl font-black text-lg flex items-center justify-center shadow-2xl hover:shadow-3xl hover:from-emerald-600 active:scale-[0.97] transition-all"
                        >
                            ğŸ’¾ ä¸‹è¼‰åˆ—å°
                        </a>
                    </div>
                </div>
            )}
        </div>
    );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
